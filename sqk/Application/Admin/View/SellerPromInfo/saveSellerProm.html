<!DOCTYPE html>
<html lang="en">
    <head>
        {$Think.const.ADMIN_META}{$Think.const.ADMIN_CSS}{$Think.const.ADMIN_COMPATIBLE}{$Think.const.ADMIN_JS}{$Assigndata}{$Think.const.DATEPICKER}
        <link rel="stylesheet" href="/Public/admin/css/common.css">
        <script type="text/javascript" src="/Public/Plugin/layer-v3.0.2/layer.js"></script>
        <script type="text/javascript" src="/Public/Plugin/ueditor1.4.3.3/ueditor.config.js" charset="UTF-8"></script>
        <script type="text/javascript" src="/Public/Plugin/ueditor1.4.3.3/ueditor.all.min.js" charset="UTF-8"></script>
        <script type="text/javascript" src="/Public/Plugin/ueditor1.4.3.3/lang/zh-cn/zh-cn.js" charset="UTF-8"></script>
        <script type="text/javascript" src="/Public/admin/js/common.js"></script>
        <script type="text/javascript" src="/Public/admin/js/seller/sellerPromInfo.js"></script>
    </head>
    <body>
        <!--添加信息-->
        <div class="container">
            <form method="post" class="form-horizontal" id="save-form" style="margin-top: 20px;">
                <input type="hidden" name="id" value="{$sellerPromInfo.id}"/>
                <input type="hidden" name="from" value="{$from}"/>
                <if condition="$from neq ''">
                    <input type="hidden" name="seller_id" value="{$sellerPromInfo.seller_id}"/>
                </if>
                <div class="form-group">
                    <label for="address_id" class="col-sm-2 control-label">所属社区</label>
                    <if condition="$Think.session.sys_name eq 'sysAdmin'">
                    <div class="col-sm-8">
                        <select class="form-control" id="address_id" name="address_id">
                            <option value='0'>全体社区</option>
                            <foreach name="communitys" item="val" >
                                <option value='{$val.id}' <if condition="$val.id eq $sellerPromInfo['address_id']"> selected </if> >
                                    {$val.com_name}
                                </option>
                            </foreach>
                        </select>
                    </div>
                    <label class="col-sm-2"><span class="tipMsg">*必选</span></label>
                    <elseif condition="$Think.session.sys_name eq 'sqAdmin'"/>
                        <label style="line-height: 33px;margin-left: 12px;">{$community}</label>
                    </if>
                </div>

                <if condition="$Think.session.sys_name eq 'sqAdmin'">
                <div class="form-group">
                    <label for="address_id" class="col-sm-2 control-label">商&#12288;&#12288;家</label>
                        <div class="col-sm-8">
                            <select class="form-control" id="seller_id" name="seller_id">
                                <foreach name="sellers" item="val" >
                                    <option value='{$val.id}' <if condition="$val.id eq $sellerPromInfo['seller_id']"> selected </if> >
                                    {$val.name}
                                    </option>
                                </foreach>
                            </select>
                        </div>
                        <label class="col-sm-2"><span class="tipMsg">*必选</span></label>
                </div>
                </if>

                <div class="form-group" id="sellers-select-div">

                </div>

                <div class="form-group">
                    <label for="title" class="col-sm-2 control-label">标&#12288;&#12288;题</label>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="title" name="title" value="{$sellerPromInfo.title}" placeholder="请输入标题">
                    </div>
                    <label class="col-sm-2"><span class="tipMsg">*必填</span></label>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">促销时间</label>
                    <div class="col-sm-5" >
                        <div class="input-group">
                            <input type="text" class="form-control" id="start_time" name="start_time" value="{$sellerPromInfo.start_time}" placeholder="请输入开始时间">
                            <span class="input-group-addon">至</span>
                            <input type="text" class="form-control" id="end_time" name="end_time" value="{$sellerPromInfo.end_time}" placeholder="请输入结束时间">
                        </div>
                    </div>
                    <label class="col-sm-2"><span class="tipMsg">*必填</span></label>
                </div>
                <div class="form-group">
                    <label for="editor" class="col-sm-2 control-label">内&#12288;&#12288;容</label>
                    <div class="col-sm-8">
                        <script id="editor" type="text/plain" name="content"></script>
                    </div>
                </div>
                <div class="form-group select-items" style="display: none;">
                    <label for="item_table" class="col-sm-2 control-label"></label>
                    <div class="col-sm-9">
                        <table class="table table-hover" id="select_item_table">
                            <tr class="itemsTableTitle">
                                <th>序号</th>
                                <th>图片</th>
                                <th>名称</th>
                                <th>分类</th>
                                <th>价格</th>
                                <th>操作</th>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"></label>
                    <div class="col-sm-9">
                        <button type="button" class="btn btn-primary" id="saveInfo-btn">提&#12288;&#12288;交</button>
                        <button type="button" class="btn btn-warning" onclick="javascript:void(window.location.href = '__CONTROLLER__/showList/seller_id/{$sellerPromInfo.seller_id}')">取&#12288;&#12288;消</button>
                    </div>
                </div>
            </form>
        </div>
    </body>
    <script type="application/javascript">
        $(document).ready(function(){
        var contentEditor =UE.getEditor('editor',{
        //这里可以选择自己需要的工具按钮名称
        toolbars: [[
        'fullscreen', 'source', '|', 'undo', 'redo', '|',
        'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript', 'removeformat', '|', 'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist', '|',
        'rowspacingtop', 'rowspacingbottom', 'lineheight', '|',
        'customstyle', 'paragraph', 'fontfamily', 'fontsize', '|',
        'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|',
        'link', 'unlink', '|','simpleupload', 'insertimage'
        ]],
        //focus时自动清空初始化时的内容
        autoClearinitialContent:true,
        //关闭字数统计
        wordCount:true,
        //关闭elementPath
        elementPathEnabled:false,
        //默认的编辑区域高度
        initialFrameHeight:450,
        })
        //初始化编辑器的值
        contentEditor.ready(function(){
        contentEditor.setContent('{$sellerPromInfo.content}');
        });
        $('#start_time').datepicker({changeMonth:true,changeYear:true});
        $('#end_time').datepicker({changeMonth:true,changeYear:true});

        //修改详情时渲染商家列表select
        listSellers();

        //点击改变社区时渲染商家列表select
        $("#address_id").change(function () {
            listSellers();
        })

        function listSellers() {
            var address_id = $("#address_id").val();
            $.ajax({
                url : '__CONTROLLER__/getSellerListSync',
                type : 'post',
                data : {address_id : address_id},
                success : function (res) {
                    if(res.code == 0) {
                        var sellers = eval(res.sellers);
                        var str = '<label for="address_id" class="col-sm-2 control-label">商家</label> <div class="col-sm-8"> <select class="form-control" id="seller_id" name="seller_id">';
                        for(var i = 0; i < sellers.length; i++) {
                            var id = sellers[i]['id'];
                            var name = sellers[i]['name'];
                            str = str + '<option value='+id+'';
                            if(id == "{$sellerPromInfo['seller_id']}") {
                                str = str + ' selected' ;
                            }
                            str = str + '>'+name+'</option>';
                        }
                        str = str + '</select></div><label class="col-sm-2"><span class="tipMsg">*必选</span></label>';
                        $("#sellers-select-div").html(str);
                    } else {
                        $("#sellers-select-div").html('');
                    }
                }
            })
        }

        });
    </script>
</html>